{% extends 'base.html' %}

{% block meta %}
<title>Send Food Waste</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
    crossorigin="anonymous"></script>

<link rel="stylesheet" type="text/css" href="/static/css/send_foodwaste/send_foodwaste.css">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% endblock meta %}

{% block content %}
<div class="d-flex flex-wrap justify-content-start" id="foodwaste"></div>

<div class="center container-fluid bg">
    <h4 class="pt-5">
        Send your food waste here
    </h4>
    <p>Fill in the information below</p>
</div>

<form class="width-50" id="food-form" method="POST" action="/send_foodwaste/add_foodwaste/">
    {% csrf_token %}
    <div class="form-floating mb-3">
        <input type="text" class="form-control" id="input_name" name="name" placeholder="Name" required>
        <label for="input_name">Name</label>
    </div>

    <div class="form-floating mb-3">
        <input type="text" class="form-control" id="input_address" name="address" placeholder="Address" required>
        <label for="input_address">Address</label>
    </div>

    <div class="form-floating mb-3">
        <input type="text" class="form-control" id="input_number" name="phone_number" placeholder="Phone number" required>
        <label for="input_number">Phone number</label>
    </div>

    <div class="form-floating mb-3">
        <input type="date" class="form-control" id="input_date" name="expiry_date" placeholder="Expiry date" required>
        <label for="input_date">Expiry date</label>
    </div>

    <div class="mb-3">
        <label class="ps-2 me-2" for="type">Food type</label>
        <select name="food_type" id="type" form="food-form">
            <option value="meat">Meat</option>
            <option value="fruits&vegetables">Fruits and Vegetables</option>
            <option value="dairy">Dairy</option>
            <option value="seafood">Seafood</option>
        </select>
    </div>

    <div class="form-floating mb-3">
        <input type="number" class="form-control" id="input_weight" name="weight" placeholder="Weight" required>
        <label for="input_weight">Weight(grams)</label>
    </div>

    <div class="center mb-3">
        <button class="btn login_btn bg-primary text-white" type="submit" value="Submit">
            Submit
        </button>
    </div>
</form>

<script>
    function show() {
        $.ajax({
            url: "json/"
        }).done(data => {
            data.forEach(food => {
                let hasil = `
                    <div class="card mb-3 width-30">
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">${food.fields.name}</li>
                            <li class="list-group-item">${food.fields.address}</li>
                            <li class="list-group-item mb-2">${food.fields.phone_number}</li>
                            <li class="list-group-item mb-2">${food.fields.food_type}</li>
                            <li class="list-group-item mb-2">${food.fields.expiry_date}</li>
                            <li class="list-group-item mb-2">${food.fields.weight}</li>
                        </ul>
                        <div style="text-align: center;">
                            <button><a href="delete_foodwaste/${food.pk}">Delete</a></button> 
                        </div>
                    </div>
                    </div>
                </div>`
                $('#foodwaste').append(hasil)
            })
        })
    }

    $(document).ready(function () {
        show()
    })
</script>

<script>
    $(document).ready(function () {
            $("#food-form").submit(function (e) {
                e.preventDefault()
                var form = $(this)
                $.ajax({
                    type: "POST",
                    url: "add_foodwaste/",
                    data: form.serialize(),
                    success: function (data) {
                        $('#foodwaste').html("")
                        show()
                    }
                });
            })
        })
</script>
{% endblock content %}